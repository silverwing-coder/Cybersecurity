<h5><em>Ver: Aug-2022</em></h5>

---

<h2>SMTP Exploits</h2>

SMTP: Simple Mail Transfer Protocol

1. A server-to-server protocol which is different to POP3 or IMAP
2. Attackers can leverage insecure SMTP servers to distribute spam and phishing mails
3. Ports for email protocols
 <ul>
  <li>TCP 25: Default SMTP for non-encrypted communications</li>
  <li>TCP 465: SMTP over SSL (SMTPS), depricated in favor of STARTTLS</li>
  <li>TCP 587: Secure SMTP (SSMTP) for encrypted communication. Defined in RFC 2487. STARTTLS can be used over TCP 25</li>
  <li>TCP 110: Default POP3 for non-encrypted communications</li>
  <li>TCP 995: Default POP3 for encrypted communications</li>
  <li>TCP 143: Default IMAP for non-encrypted communications</li>
  <li>TCP 993: Default IMAP for encrypted communications (SSL/TLS)</li>
  </ul>

4. SMTP commands

 <ul>
 <li>HELO</li>
 <li>EHLO</li>
 <li>STARTTLS</li>
 <li>RCPT</li>
 <li>DATA</li>
 <li>RSET</li>
 <li>MAIL</li>
 <li>QUIT</li>
 <li>HELP</li>
 <li>AUTH</li>
 <li>VRFY</li>
 <li>EXPN</li>
 </ul>

---

<h4>Tools</h4>

1. Namp NSE(Nmap script engine): https://nmap.org/book/man-nse.html
2. snmp-user-enum
3. searchsploit

```sh
# SMTP open relay
nmap --script smtp-open-relay.nse mail-server-ip

# SMTP VRFY command with telnet on port #25
telnet mail-server-ip 25
VRFY options

# Automate information gathering steps
smtp-user-enum -M VRFY -U user.txt -t mail-server-ip
smtp-user-enum -M EXPN -u admin1 -t mail-server-ip
smtp-user-enum -M RCPT -U user.txt -T mail-server-ips.txt
smtp-user-enum -M EXPN -D example.com user.txt -t mail-server-ip

# Search know SMTP vulnerabilities
searchsploit smtp

```
